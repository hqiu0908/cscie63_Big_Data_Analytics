<!DOCTYPE html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Image Requests by Format Pie Chart</title>
    <script type="text/javascript" src="../d3/d3.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style type="text/css">
        .arc text {
            font: 10px sans-serif;
            text-anchor: middle;
        }

        div.tooltip {
            position: absolute;
            text-align: center;
            width: 80px;
            height: 40px;
            padding: 2px;
            font: 11px sans-serif;
            background: lightsteelblue;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }
    </style>
</head>
<body>

<h1>Image Requests by Format (2016-04-15) </h1>
<p id="chart"></p>

<script type="text/javascript">

    var width = 960,
            height = 500,
            radius = Math.min(width, height) / 2;

    var color = d3.scale.category20();

    var arc = d3.svg.arc()
            .outerRadius(radius)
            .innerRadius(0);

    var labelArc = d3.svg.arc()
            .outerRadius(radius - 40)
            .innerRadius(radius - 40);

    var pie = d3.layout.pie()
            .sort(order)
            .value(function (d) {
                return d.number;
            });

    var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

    function order(a, b) {
        return d3.ascending(a.number, b.number);
    }

    // Define the div for the tooltip
    var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

    d3.csv("ImgRqstByFormat.csv", type, function (error, data) {
        if (error) throw error;

        var arcs = svg.selectAll("arc")
                .data(pie(data))
                .enter()
                .append("g")
                .attr("class", "arc")
                .attr("transform", "translate(" + radius + ", " + radius + ")");

        arcs.append("path")
                .style("fill", function (d) {
                    return color(d.data.number);
                })
                .attr("d", arc)
                .on("mouseover", function (d) {
                    // d3.select(this).style("opacity", .5);
                    d3.select(this).style("fill", "#9933ff")
                    div.transition()
                            .duration(200)
                            .style("left", d3.mouse(this)[0] + 300 + "px")
                            .style("top", d3.mouse(this)[1] + 300 + "px")
                            .style("opacity", .9);
                    div.html(d.data.format + "<br/>" + d.data.number)
                })
                .on("mouseout", function (d) {
                    // d3.select(this).style("opacity", 1);
                    d3.select(this).style("fill", color(d.data.number))
                    div.transition()
                            .duration(500)
                            .style("opacity", 0);
                });

        arcs.append("text")
                .attr("transform", function (d) {
                    return "translate(" + labelArc.centroid(d) + ")";
                })
                .attr("dy", ".35em")
        //.text(function(d) { return d.data.format; });
    });

    function type(d) {
        d.number = +d.number;
        return d;
    }

</script>